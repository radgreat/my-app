<% layout('layouts/layout') %>

<div class="row justify-content-center">
  <div class="col-md-6 col-lg-5">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <!-- <h2 class="text-center mb-4">üîê Login</h2> -->
         <h2 class="text-center mb-4">Task Manager</h2>

        <% if (success && success.length > 0) { %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= success[0] %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% } %>

        <% if (error && error.length > 0) { %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%- error[0] %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% } %>           

        <form action="/auth/login" method="POST">
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= formData.email || '' %>" required autofocus>
          </div>

          <div class="mb-3 position-relative">
            <label for="password" class="form-label">Password</label>
            <div class="input-group w-100">
              <input type="password" class="form-control border-end-0" id="password" name="password" value="<%= formData.password || '' %>" required>
              <span class="input-group-text bg-white border-start-0" style="border-left: none;">
                <i class="bi bi-eye-slash toggle-password" id="togglePassword" style="cursor: pointer;"></i>
              </span>     
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Login</button>

          <div class="text-center my-3">
            <small class="text-muted">or login with</small>
          </div>

          <div class="d-grid gap-2 mb-3">
            <a href="/auth/google" class="btn btn-outline-danger">
              <i class="bi bi-google me-2"></i> Login with Google
            </a>
            <a href="/auth/facebook" class="btn btn-outline-primary">
              <i class="bi bi-facebook me-2"></i> Login with Facebook
            </a>
          </div>

          </div>
        </form>

        <div class="mt-3 text-center">
          <small>
            Forgot password? <a href="/auth/reset-password">Reset here</a> <br>
            Don't have an account? <a href="/auth/register">Register</a>
            <% if (error && error.length > 0 && error.some(msg => msg.includes('verify'))) { %>
              <div class="mt-2">
                <a href="/auth/resend-verification">Resend verification email?</a>
              </div>
            <% } %>
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  window.addEventListener('pageshow', function (event) {
    if (event.persisted || window.performance.navigation.type === 2) {
      // If the page was loaded from cache (back/forward nav), reload it
      window.location.reload();
    }
  });
</script>